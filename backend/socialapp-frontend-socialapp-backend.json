{
  "consumer": {
    "name": "SocialApp-Frontend"
  },
  "provider": {
    "name": "SocialApp-Backend"
  },
  "interactions": [
    {
      "description": "a request to register a new user",
      "providerState": "User registration endpoint is available",
      "request": {
        "method": "post",
        "path": "/auth/register",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "email": "test@example.com",
          "password": "securepassword"
        },
        "matchingRules": {
          "$.body.email": {
            "match": "regex",
            "regex": ".+@.+\\..+"
          },
          "$.body.password": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 201,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "user_id": 123,
          "message": "User registered successfully"
        },
        "matchingRules": {
          "$.body.user_id": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to login",
      "providerState": "User exists with valid credentials",
      "request": {
        "method": "post",
        "path": "/auth/login",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "email": "existing@example.com",
          "password": "password"
        },
        "matchingRules": {
          "$.body.email": {
            "match": "regex",
            "regex": ".+@.+\\..+"
          },
          "$.body.password": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "token": "jwt.token.here",
          "user_id": 123,
          "message": "Login successful"
        },
        "matchingRules": {
          "$.body.token": {
            "match": "type"
          },
          "$.body.user_id": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to create a post",
      "providerState": "User is authenticated",
      "request": {
        "method": "post",
        "path": "/posts",
        "headers": {
          "Content-Type": "application/json",
          "x-access-token": "valid.jwt.token"
        },
        "body": {
          "image_url": "/uploads/image.jpg",
          "caption": "This is a test post"
        },
        "matchingRules": {
          "$.headers.x-access-token": {
            "match": "type"
          },
          "$.body.image_url": {
            "match": "type"
          },
          "$.body.caption": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 201,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "message": "Post created successfully",
          "post_id": 456
        },
        "matchingRules": {
          "$.body.post_id": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to get user posts",
      "providerState": "User has posts",
      "request": {
        "method": "get",
        "path": "/users/123/posts",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.path": {
            "match": "regex",
            "regex": "\\/users\\/\\d+\\/posts"
          },
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": [
          {
            "post_id": 123,
            "user_id": 456,
            "image_url": "/uploads/post1.jpg",
            "caption": "Post caption",
            "created_at": "2024-01-01T12:00:00",
            "author_display_name": "John Doe",
            "author_profile_picture_url": "/uploads/profile1.jpg",
            "like_count": 5,
            "user_has_liked": false,
            "comment_count": 3,
            "recent_comments": [
              {
                "id": 789,
                "content": "Great post!",
                "author_display_name": "Jane Smith",
                "author_profile_picture_url": "/uploads/profile2.jpg",
                "created_at": "2024-01-01T12:30:00"
              }
            ]
          }
        ],
        "matchingRules": {
          "$.body": {
            "min": 1
          },
          "$.body[*].*": {
            "match": "type"
          },
          "$.body[*].post_id": {
            "match": "type"
          },
          "$.body[*].user_id": {
            "match": "type"
          },
          "$.body[*].image_url": {
            "match": "type"
          },
          "$.body[*].caption": {
            "match": "type"
          },
          "$.body[*].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          },
          "$.body[*].author_display_name": {
            "match": "type"
          },
          "$.body[*].author_profile_picture_url": {
            "match": "type"
          },
          "$.body[*].like_count": {
            "match": "type"
          },
          "$.body[*].user_has_liked": {
            "match": "type"
          },
          "$.body[*].comment_count": {
            "match": "type"
          },
          "$.body[*].recent_comments": {
            "min": 1
          },
          "$.body[*].recent_comments[*].*": {
            "match": "type"
          },
          "$.body[*].recent_comments[*].id": {
            "match": "type"
          },
          "$.body[*].recent_comments[*].content": {
            "match": "type"
          },
          "$.body[*].recent_comments[*].author_display_name": {
            "match": "type"
          },
          "$.body[*].recent_comments[*].author_profile_picture_url": {
            "match": "type"
          },
          "$.body[*].recent_comments[*].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          }
        }
      }
    },
    {
      "description": "a request to toggle like on a post",
      "providerState": "Post exists and user is connected to post author",
      "request": {
        "method": "post",
        "path": "/posts/123/like",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.path": {
            "match": "regex",
            "regex": "\\/posts\\/\\d+\\/like"
          },
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "message": "Post liked successfully",
          "action": "liked",
          "like_count": 6,
          "user_has_liked": true
        },
        "matchingRules": {
          "$.body.message": {
            "match": "type"
          },
          "$.body.action": {
            "match": "regex",
            "regex": "(liked|unliked)"
          },
          "$.body.like_count": {
            "match": "type"
          },
          "$.body.user_has_liked": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to add a comment",
      "providerState": "Post exists and user is connected to post author",
      "request": {
        "method": "post",
        "path": "/posts/123/comments",
        "headers": {
          "Content-Type": "application/json",
          "x-access-token": "valid.jwt.token"
        },
        "body": {
          "content": "This is a test comment"
        },
        "matchingRules": {
          "$.path": {
            "match": "regex",
            "regex": "\\/posts\\/\\d+\\/comments"
          },
          "$.headers.x-access-token": {
            "match": "type"
          },
          "$.body.content": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 201,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "message": "Comment added successfully",
          "comment": {
            "id": 987,
            "content": "This is a test comment",
            "author_display_name": "Test User",
            "author_profile_picture_url": "/uploads/profile.jpg",
            "created_at": "2024-01-01T13:00:00"
          }
        },
        "matchingRules": {
          "$.body.comment.id": {
            "match": "type"
          },
          "$.body.comment.content": {
            "match": "type"
          },
          "$.body.comment.author_display_name": {
            "match": "type"
          },
          "$.body.comment.author_profile_picture_url": {
            "match": "type"
          },
          "$.body.comment.created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          }
        }
      }
    },
    {
      "description": "a request to get comments with pagination",
      "providerState": "Post has comments",
      "request": {
        "method": "get",
        "path": "/posts/123/comments",
        "query": "page=1&per_page=10",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.path": {
            "match": "regex",
            "regex": "\\/posts\\/\\d+\\/comments"
          },
          "$.query.page[0]": {
            "match": "type"
          },
          "$.query.per_page[0]": {
            "match": "type"
          },
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "comments": [
            {
              "id": 123,
              "content": "Great post!",
              "author_display_name": "Commenter",
              "author_profile_picture_url": "/uploads/commenter.jpg",
              "created_at": "2024-01-01T14:00:00"
            }
          ],
          "pagination": {
            "page": 1,
            "per_page": 10,
            "total": 25,
            "pages": 3
          }
        },
        "matchingRules": {
          "$.body.comments": {
            "min": 1
          },
          "$.body.comments[*].*": {
            "match": "type"
          },
          "$.body.comments[*].id": {
            "match": "type"
          },
          "$.body.comments[*].content": {
            "match": "type"
          },
          "$.body.comments[*].author_display_name": {
            "match": "type"
          },
          "$.body.comments[*].author_profile_picture_url": {
            "match": "type"
          },
          "$.body.comments[*].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          },
          "$.body.pagination.page": {
            "match": "type"
          },
          "$.body.pagination.per_page": {
            "match": "type"
          },
          "$.body.pagination.total": {
            "match": "type"
          },
          "$.body.pagination.pages": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to like a non-existent post",
      "providerState": "Post does not exist",
      "request": {
        "method": "post",
        "path": "/posts/99999/like",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 404,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "error": "Post not found",
          "status_code": 404
        },
        "matchingRules": {
          "$.body.error": {
            "match": "type"
          },
          "$.body.status_code": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to get user notifications",
      "providerState": "User has unread notifications",
      "request": {
        "method": "get",
        "path": "/api/notifications",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": [
          {
            "id": 123,
            "user_id": 456,
            "actor_user_id": 789,
            "type": "post_liked",
            "post_id": 101,
            "message": "John Doe liked your post",
            "target_url": "/posts/101",
            "is_read": false,
            "created_at": "2024-01-01T12:00:00"
          }
        ],
        "matchingRules": {
          "$.body": {
            "min": 1
          },
          "$.body[*].*": {
            "match": "type"
          },
          "$.body[*].id": {
            "match": "type"
          },
          "$.body[*].user_id": {
            "match": "type"
          },
          "$.body[*].actor_user_id": {
            "match": "type"
          },
          "$.body[*].type": {
            "match": "regex",
            "regex": "(post_liked|post_commented|connection_request|connection_accepted)"
          },
          "$.body[*].post_id": {
            "match": "type"
          },
          "$.body[*].message": {
            "match": "type"
          },
          "$.body[*].target_url": {
            "match": "type"
          },
          "$.body[*].is_read": {
            "match": "type"
          },
          "$.body[*].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          }
        }
      }
    },
    {
      "description": "a request to get user notifications",
      "providerState": "User has no notifications",
      "request": {
        "method": "get",
        "path": "/api/notifications",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": [

        ]
      }
    },
    {
      "description": "a request to mark notification as read",
      "providerState": "Notification exists and is unread",
      "request": {
        "method": "post",
        "path": "/api/notifications/123/mark-read",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.path": {
            "match": "regex",
            "regex": "\\/api\\/notifications\\/\\d+\\/mark-read"
          },
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "message": "Notification marked as read",
          "notification_id": 123
        },
        "matchingRules": {
          "$.body.notification_id": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to mark all notifications as read",
      "providerState": "User has multiple unread notifications",
      "request": {
        "method": "post",
        "path": "/api/notifications/mark-all-read",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "message": "All notifications marked as read",
          "count": 5
        },
        "matchingRules": {
          "$.body.count": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to get notifications without token",
      "providerState": "User is not authenticated",
      "request": {
        "method": "get",
        "path": "/api/notifications"
      },
      "response": {
        "status": 401,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "error": "Access token required",
          "status_code": 401
        },
        "matchingRules": {
          "$.body.status_code": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to mark non-existent notification as read",
      "providerState": "Notification does not exist",
      "request": {
        "method": "post",
        "path": "/api/notifications/99999/mark-read",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 404,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "error": "Notification not found",
          "status_code": 404
        },
        "matchingRules": {
          "$.body.status_code": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request to get notifications with all types",
      "providerState": "User has notifications of all types",
      "request": {
        "method": "get",
        "path": "/api/notifications",
        "headers": {
          "x-access-token": "valid.jwt.token"
        },
        "matchingRules": {
          "$.headers.x-access-token": {
            "match": "type"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": [
          {
            "id": 1,
            "user_id": 456,
            "actor_user_id": 789,
            "type": "post_liked",
            "post_id": 123,
            "message": "Alice Smith liked your post",
            "target_url": "/posts/123",
            "is_read": false,
            "created_at": "2024-01-01T12:00:00"
          },
          {
            "id": 2,
            "user_id": 456,
            "actor_user_id": 790,
            "type": "post_commented",
            "post_id": 124,
            "message": "Bob Jones commented on your post",
            "target_url": "/posts/124",
            "is_read": false,
            "created_at": "2024-01-01T12:00:00"
          },
          {
            "id": 3,
            "user_id": 456,
            "actor_user_id": 791,
            "type": "connection_request",
            "post_id": null,
            "message": "Charlie Brown has requested a connection",
            "target_url": "/connections",
            "is_read": false,
            "created_at": "2024-01-01T12:00:00"
          },
          {
            "id": 4,
            "user_id": 456,
            "actor_user_id": 792,
            "type": "connection_accepted",
            "post_id": null,
            "message": "Diana Evans accepted your connection request",
            "target_url": "/connections",
            "is_read": false,
            "created_at": "2024-01-01T12:00:00"
          }
        ],
        "matchingRules": {
          "$.body[0].id": {
            "match": "type"
          },
          "$.body[0].user_id": {
            "match": "type"
          },
          "$.body[0].actor_user_id": {
            "match": "type"
          },
          "$.body[0].is_read": {
            "match": "type"
          },
          "$.body[0].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          },
          "$.body[1].id": {
            "match": "type"
          },
          "$.body[1].user_id": {
            "match": "type"
          },
          "$.body[1].actor_user_id": {
            "match": "type"
          },
          "$.body[1].is_read": {
            "match": "type"
          },
          "$.body[1].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          },
          "$.body[2].id": {
            "match": "type"
          },
          "$.body[2].user_id": {
            "match": "type"
          },
          "$.body[2].actor_user_id": {
            "match": "type"
          },
          "$.body[2].is_read": {
            "match": "type"
          },
          "$.body[2].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          },
          "$.body[3].id": {
            "match": "type"
          },
          "$.body[3].user_id": {
            "match": "type"
          },
          "$.body[3].actor_user_id": {
            "match": "type"
          },
          "$.body[3].is_read": {
            "match": "type"
          },
          "$.body[3].created_at": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}"
          }
        }
      }
    }
  ],
  "metadata": {
    "pactSpecification": {
      "version": "2.0.0"
    }
  }
}
